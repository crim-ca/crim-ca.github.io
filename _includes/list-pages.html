{% if len([item for item in site.pages if item.name not in ['index.md', 'index.html', 'README.md']) %}
<h2>Pages</h2>
{% endif %}

{% comment %}
    List directories which are in the current directory.
{% endcomment %}

<ul>
    {% for item in site.pages %}
        {% assign item_crumbs = item.url | remove_first: page.dir | split: '/' %}

        {% if item_crumbs.size == 1 and item.name == 'index.md' %}
        <li>
            <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
        </li>
        {% endif %}
    {% endfor %}
</ul>

{% comment %}
    List pages in same directory as the current page, excluding the page itself.
{% endcomment %}

<ul>
    {% for item in site.pages %}
        {% if item.dir == page.dir and item.path != page.path %}
        <li>
            <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
        </li>
        {% endif %}
    {% endfor %}
</ul>
